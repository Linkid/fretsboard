{% extends "base.html" %}
{% load static %}
{% load i18n %}


{% block title %}
  {% blocktrans with title=song.title artist=song.artist %}
    {{ title }} by {{ artist }}
  {% endblocktrans %}
{% endblock %}

{% block header %}
  <h1>
    {% blocktrans with title=song.title artist=song.artist %}
      <em>{{ title }}</em> (by <em>{{ artist }}</em>)
    {% endblocktrans %}
  </h1>
{% endblock %}


{% block content %}
<p>
  {% blocktrans with score_count=song.score_set.count score_count_p=song.score_set.count|pluralize %}
    This song has been played {{ score_count }} time{{ score_count_p }}.
  {% endblocktrans %}
</p>

{% regroup song.score_set.all|dictsort:"difficulty" by difficulty as difficulties_scores %}

{% for difficulty, scores in difficulties_scores %}
<h2>{{ difficulty }}</h2>
<table class="table table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>{% trans "Player" %}</th>
      <th>{% trans "Score" %}</th>
      <th>{% trans "Stars" %}</th>
    </tr>
  <thead>

  <tbody>
  {% for score in scores|dictsortreversed:"score"|slice:":10" %}
  <tr>
    <td>{{ forloop.counter }}</td>
    <td><a href="{% url "player" score.player.name %}">{{ score.player.name }}</a></td>
    <td>
      {% if forloop.counter == 1 %}
        <img src="{% static 'img/gold.png' %}" alt="{% trans 'Gold' %}" />
      {% elif forloop.counter == 2 %}
        <img src="{% static 'img/silver.png' %}" alt="{% trans 'Silver' %}" />
      {% elif forloop.counter == 3 %}
        <img src="{% static 'img/bronze.png' %}" alt="{% trans 'Bronze' %}" />
      {% endif %}
      {{ score.score }}
    </td>
    <td>
      {% for star_state in score.stars_state %}
        {% if star_state %}
          <span class="glyphicon glyphicon-star"></span>
        {% else %}
          <span class="glyphicon glyphicon-star-empty"></span>
        {% endif %}
      {% endfor %}
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endfor %}
{% endblock %}
